    <style>
        /* ======================================== */
        /* Base Styles & Variables                */
        /* ======================================== */
        :root {
            --bg-dark: #121212;
            --bg-secondary: #1e1e1e;
            --bg-content: #181818;
            --text-light: #e0e0e0;
            --text-dark: #121212;
            --primary-orange: #ff6600;
            --primary-orange-darker: #e65c00;
            --border-light: #444;
            --rank-bronze-bg: #cd7f32;
            --rank-silver-bg: #c0c0c0;
            --rank-gold-bg: #ffd700;
            --rank-platinum-bg: #40E0D0;
            --rank-default-bg: #555;
            --text-secondary: #aaa;
            /* Badge Colors */
            --badge-verified-bg: #00acee;
            --badge-creator-bg: #a970ff;
            --badge-moderator-bg: #ff6600;
            --badge-tick-color: #ffffff;
            /* Banner/PFP Fallback */
            --banner-fallback-bg: #333;
            --pfp-fallback-bg: var(--bg-secondary);

            /* Shadows & Radius */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.4);
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;

            /* Content Width (Increased) */
            --content-max-width: 1150px; /* <<< INCREASED WIDTH */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-content);
            color: var(--text-light);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        main {
            flex-grow: 1;
            padding-top: 0;
            width: 100%;
        }

        /* ======================================== */
        /* Header & Navigation (Shared - Unchanged) */
        /* ======================================== */
        header { /* ... */ } .nav-container { /* ... */ } .logo { /* ... */ } .auth-buttons { /* ... */ }

        /* ======================================== */
        /* Buttons (Shared - Unchanged)           */
        /* ======================================== */
        .btn { /* ... */ } .btn:disabled { /* ... */ } .btn:active:not(:disabled) { /* ... */ } .btn-primary { /* ... */ } .btn-secondary { /* ... */ }
        /* Friend Button Styles (Unchanged) */
        .btn-small { /* ... */ } .btn-accept { /* ... */ } .btn-decline, .btn-cancel, .btn-remove { /* ... */ }

        /* ======================================== */
        /* NEW Profile Header Area                */
        /* ======================================== */
        #profile-header-area {
            position: relative; width: 100%; margin-bottom: 70px; /* Adjusted bottom margin */
        }
        #profile-banner {
            width: 100%; padding-top: 25%; /* 4:1 ratio */ background-color: var(--banner-fallback-bg);
            background-size: cover; background-position: center center; background-repeat: no-repeat;
            position: relative; border-bottom: 1px solid var(--border-light);
        }
        /* Edit Icons */
        .edit-icon { /* ... unchanged generic style ... */ position: absolute; background-color: rgba(0, 0, 0, 0.6); color: white; border-radius: 50%; width: 35px; height: 35px; display: none; justify-content: center; align-items: center; cursor: pointer; font-size: 1rem; border: 1px solid rgba(255, 255, 255, 0.5); transition: background-color 0.2s ease; z-index: 5;}
        .edit-icon:hover { /* ... */ }
        #edit-banner-icon { top: 15px; right: 15px; }
        #profile-pic { /* ... positioning unchanged ... */ position: absolute; width: 150px; height: 150px; border-radius: 50%; background-color: var(--pfp-fallback-bg); color: var(--text-light); display: flex; justify-content: center; align-items: center; border: 5px solid var(--bg-content); box-shadow: var(--shadow-md); overflow: hidden; cursor: default; flex-shrink: 0; bottom: -75px; left: 40px; z-index: 3;}
        #profile-pic #profile-initials { /* ... */ } #profile-pic img { /* ... */ }
        #edit-profile-pic-icon { bottom: 8px; right: 8px; width: 30px; height: 30px; font-size: 0.9rem; }

        /* ======================================== */
        /* NEW Profile Info Area (Below Header)   */
        /* ======================================== */
        #profile-info-area {
             /* Uses --content-max-width which was increased */
             max-width: var(--content-max-width); margin: -1px auto 0; padding: 25px 30px 30px; text-align: left; position: relative;
             background-color: var(--bg-secondary); border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg); box-shadow: var(--shadow-sm);
        }
        /* Elements within Info Area */
        .profile-name-container { display: flex; align-items: center; justify-content: flex-start; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.4rem; }
        #profile-username { /* ... */ }
        #profile-badges-container { /* ... */ }
        .profile-badge { /* ... */ } .badge-verified { /* ... */ } .badge-creator { /* ... */ } .badge-moderator { /* ... */ }
        .admin-tag { /* ... */ }
        .profile-identifiers { display: flex; align-items: center; flex-wrap: wrap; justify-content: flex-start; gap: 0.8rem; margin-bottom: 1rem; position: relative; min-height: 25px; }
        .profile-rank-display { /* ... */ } /* Rank classes ... */
        .profile-title-display { /* ... */ } #profile-title.selectable-title { /* ... */ } #profile-title.no-title-placeholder { /* ... */ }
        .title-selector { /* ... position adjusted ... */ } .title-option { /* ... */ } /* etc. */
        #friendship-controls-container { display: flex; justify-content: flex-start; gap: 0.5rem; margin-top: 0.5rem; min-height: 40px; }
        #friendship-controls-container button { margin-right: 0; }
        #profile-email { display: none; }

        /* ======================================== */
        /* Section Styles (Stats, Friends, Achiev.) */
        /* ======================================== */
        /* Common wrapper uses --content-max-width */
        .content-section-wrapper { width: 100%; padding: 2rem 1rem; margin: 2rem auto 0; box-sizing: border-box; background-color: var(--bg-secondary); border-radius: var(--border-radius-lg); box-shadow: var(--shadow-sm); max-width: var(--content-max-width); /* Apply max-width here too */ }
        .content-limiter { /* This might be redundant now if applied to wrapper, but harmless */ max-width: 100%; /* Take full width of wrapper */ margin: 0 auto; }
        .profile-stats, .profile-section { margin-top: 0; border-top: none; padding-top: 0; text-align: left; }
        .profile-stats h3, .profile-section h3 { /* ... */ }

        /* Stats Grid (Unchanged) */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem; text-align: left; } .stats-grid > p { /*...*/ } .stat-item { /*...*/ } /* etc. */

        /* Friend System Styles (Unchanged Internally) */
        #friends-section h3 { /* ... */ } /* etc. */

        /* Achievements Section Styles */
        #achievements-section h3 { /* Styles unchanged */ }
        .achievements-list {
            display: grid;
            /* UPDATED: Let grid auto-fit columns with a minimum size */
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjust 280px as needed */
            gap: 1.5rem;
            text-align: left;
        }
        .achievement-item { /* Styles mostly unchanged, ensure display:flex */
             background-color: var(--bg-dark); padding: 1.5rem; border-radius: var(--border-radius-md); border-left: 5px solid var(--text-secondary); box-shadow: var(--shadow-md); transition: border-left-color 0.3s ease, opacity 0.3s ease; opacity: 0.85; display: flex; flex-direction: column; justify-content: space-between;
        }
         /* ... rest of achievement item styles unchanged ... */
         .achievement-item.achievement-unlocked { /*...*/ }
         .achievement-item.achievement-completed { /*...*/ }
         .achievement-item h4 { /*...*/ }
         .achievement-item .completion-icon { /*...*/ }
         .achievement-item .achievement-description { /*...*/ }
         .achievement-progress-container { /*...*/ }
         .achievement-progress-bar { /*...*/ }
         .achievement-item .achievement-rewards { /*...*/ }

        /* ======================================== */
        /* Loading / Not Logged In / Messages     */
        /* ======================================== */
        #loading-profile, #not-logged-in { /* Styles unchanged */ }
        .list-message { /* Styles unchanged */ }

        /* ======================================== */
        /* Image Editing Modal (Unchanged)        */
        /* ======================================== */
        .modal-overlay { /*...*/ } /* etc. */

        /* ======================================== */
        /* Loading Spinner (Unchanged)            */
        /* ======================================== */
        .spinner { /*...*/ } @keyframes spin { /*...*/ } .btn .spinner { /*...*/ }

        /* ======================================== */
        /* Footer (Shared - Unchanged)            */
        /* ======================================== */
        footer { /* Styles unchanged */ }

        /* ======================================== */
        /* Responsive Adjustments                 */
        /* ======================================== */
        @media (max-width: 980px) { /* Add breakpoint if needed before 768px */
             :root {
                  /* Slightly reduce max width on medium-large screens */
                 --content-max-width: 95%;
             }
            /* Adjust achievement grid minmax if needed */
            .achievements-list {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .nav-container { flex-direction: column; align-items: center; gap: 0.8rem; }
            .auth-buttons { margin-top: 0.8rem; }

            #profile-banner { padding-top: 30%; }
            #profile-pic { width: 120px; height: 120px; left: 20px; bottom: -60px; }
            #profile-header-area { margin-bottom: 65px; }
            .edit-icon { width: 30px; height: 30px; }
            #edit-banner-icon { top: 10px; right: 10px; }
            #edit-profile-pic-icon { width: 25px; height: 25px; bottom: 5px; right: 5px; }

            #profile-info-area { padding: 20px; padding-top: 15px; border-radius: 0; }
            #profile-username { font-size: 1.9rem; }
            .profile-badge { font-size: 0.75em; }

            .content-section-wrapper { padding: 1.5rem 1rem; margin-top: 1.5rem; }
            .profile-stats h3, .profile-section h3 { font-size: 1.5rem; }
            .stats-grid { /* ... */ }
            /* Achievement Grid: No specific column change needed - auto-fit handles it */
            .achievements-list { gap: 1.2rem; }

            /* ... other 768px styles ... */
        }

         @media (max-width: 480px) {
            .nav-container { padding: 0 1rem; }
            .logo { font-size: 1.5rem; } /* etc */

            #profile-banner { padding-top: 35%; }
            #profile-pic { width: 100px; height: 100px; left: 15px; bottom: -50px; }
            #profile-header-area { margin-bottom: 55px; }
             /* ... other icon size adjustments ... */

            #profile-info-area { padding: 15px; padding-top: 10px; }
            #profile-username { font-size: 1.6rem; }
            .profile-name-container { flex-direction: column; align-items: flex-start; }
            .profile-badge { font-size: 0.7em; } /* Badge size */
            .admin-tag { font-size: 0.7rem; }
            .profile-identifiers { flex-direction: column; align-items: flex-start; }
             /* ... title selector static styling ... */
            #friendship-controls-container { gap: 0.3rem; flex-wrap: wrap; }

            .content-section-wrapper { padding: 1rem 0.8rem; margin-top: 1rem; }
            .profile-stats h3, .profile-section h3 { font-size: 1.4rem; }
             /* Achievement Grid: No specific column change needed */
             .achievements-list { gap: 1rem; /* Smallest gap */ }
             /* ... other small screen adjustments ... */
         }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="nav-container">
            <a href="index.html" class="logo">Poxel Competitive</a>
            <div class="auth-buttons">
                <a href="main.html" class="btn btn-secondary">Matches</a>
                <button class="btn btn-primary" id="profile-logout-btn" style="display: none;">Logout</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>

        <!-- Loading Profile Message -->
        <div id="loading-profile" style="display: flex;">
             <p>Loading profile...</p>
        </div>

        <!-- Not Logged In / Error Message -->
        <div id="not-logged-in" style="display: none;">
            <p>You need to be logged in to view this page. Redirecting...</p>
        </div>

        <!-- Profile Area (Displayed when data loaded) -->
        <div id="profile-area" style="display: none;"> <!-- Wrapper for profile content -->

            <!-- Profile Header (Banner + PFP) -->
            <div id="profile-header-area">
                <div id="profile-banner">
                     <span id="edit-banner-icon" class="edit-icon" title="Edit Banner">
                        <i class="fas fa-camera"></i>
                    </span>
                </div>
                <input type="file" id="banner-input" accept="image/png, image/jpeg, image/gif" style="display: none;">

                <!-- Profile Picture Area -->
                <div id="profile-pic">
                    <span id="profile-initials">?</span>
                    <img id="profile-image" src="" alt="Profile Picture" style="display: none;">
                    <span id="edit-profile-pic-icon" class="edit-icon" title="Edit Profile Picture">
                        <i class="fas fa-pencil-alt"></i>
                    </span>
                </div>
                <input type="file" id="profile-pic-input" accept="image/png, image/jpeg, image/gif" style="display: none;">
            </div>

            <!-- Profile Info (Name, Rank, Title, Controls) -->
            <div id="profile-info-area">
                 <div class="profile-name-container">
                    <h2 id="profile-username">Username</h2>
                    <span id="profile-badges-container"></span>
                    <span id="admin-tag" class="admin-tag">Admin</span>
                 </div>
                 <div class="profile-identifiers">
                    <span id="profile-rank" class="profile-rank-display">...</span>
                    <span id="profile-title" class="profile-title-display" style="display: none;"></span>
                    <!-- Title selector appended here by JS -->
                 </div>
                 <div id="friendship-controls-container"></div>
                 <p id="profile-email">user@example.com</p> <!-- Hidden by CSS -->
            </div>

            <!-- Competitive Stats Section -->
            <div class="content-section-wrapper" id="competitive-stats-section-wrapper" style="display: none;">
                 <div class="content-limiter">
                     <div class="profile-stats" id="competitive-stats-section">
                        <h3>Competitive Stats</h3>
                        <div class="stats-grid" id="stats-display">
                             <p class="list-message">Loading...</p>
                         </div>
                    </div>
                 </div>
            </div>

            <!-- Poxel.io Stats Section -->
             <div class="content-section-wrapper" id="poxel-stats-section-wrapper" style="display: none;">
                 <div class="content-limiter">
                    <div class="profile-stats" id="poxel-stats-section">
                        <h3>Poxel.io Stats</h3>
                        <div class="stats-grid" id="poxel-stats-display">
                             <p class="list-message">Loading...</p>
                        </div>
                     </div>
                 </div>
            </div>

            <!-- Friends Section (Only shown for own profile) -->
             <div class="content-section-wrapper" id="friends-section-wrapper" style="display: none;">
                 <div class="content-limiter">
                    <div class="profile-section" id="friends-section">
                         <h3>Friends & Requests</h3>
                         <div class="friends-tabs">
                             <button class="tab-button active" data-tab="friends-list">Friends</button>
                             <button class="tab-button" data-tab="incoming-requests">Incoming (<span id="incoming-count">0</span>)</button>
                             <button class="tab-button" data-tab="outgoing-requests">Outgoing (<span id="outgoing-count">0</span>)</button>
                         </div>
                         <div class="tab-content active" id="friends-list-container">
                             <h4>Current Friends</h4>
                             <ul class="friend-request-list" id="friends-list"></ul>
                         </div>
                         <div class="tab-content" id="incoming-requests-container">
                             <h4>Incoming Requests</h4>
                             <ul class="friend-request-list" id="incoming-requests-list"></ul>
                         </div>
                         <div class="tab-content" id="outgoing-requests-container">
                             <h4>Outgoing Requests</h4>
                             <ul class="friend-request-list" id="outgoing-requests-list"></ul>
                         </div>
                     </div>
                 </div>
            </div>

             <!-- Achievements Section (Only shown for own profile) -->
            <div class="content-section-wrapper" id="achievements-section-outer" style="display: none;">
                 <div class="content-limiter">
                    <div class="profile-section" id="achievements-section">
                        <h3>My Achievements</h3>
                        <div class="achievements-list" id="achievements-list-container">
                            <!-- JS populates this -->
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- End #profile-area -->

    </main> <!-- End main -->

    <!-- Footer -->
    <footer>
        <p>© 2024 Poxel Competitive. All rights reserved.</p>
    </footer>

    <!-- Image Editing Modal -->
    <div class="modal-overlay" id="edit-modal">
        <!-- Modal Content Unchanged -->
         <div class="modal-content"> <div class="modal-header"><h3 id="modal-title">Edit Image</h3><button class="modal-close-btn" id="modal-close-btn" title="Close">×</button></div> <div class="modal-body"><div id="cropper-image-container"><img id="image-to-crop" src="" alt="Image preview for cropping"></div></div> <div class="modal-footer"><button class="btn btn-secondary" id="modal-cancel-btn">Cancel</button><button class="btn btn-primary" id="modal-apply-btn">Apply <span class="spinner" id="modal-spinner" style="display: none;"></span></button></div> </div>
    </div>

    <!-- === External Scripts === -->
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="profile.js"></script>

</body>
</html>
